<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>OpenCircuit</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap');

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        color-scheme: dark;
        user-select: none;
        font-family: 'JetBrains Mono', monospace;
      }

      body {
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        background-color: #0f0f0f;
      }
      :root {
        --hud-offset: 200px;
      }

      canvas {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        touch-action: none;
        z-index: 1;
      }

      .hud {
        position: absolute;
        top: 15px;
        left: 15px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 12px;
        border: 1px solid #333;
        border-radius: 6px;
        background: rgba(15, 15, 15, 0.9);
        backdrop-filter: blur(8px);
        width: 180px;
        z-index: 10;
        max-height: calc(100vh - 30px);
        overflow-y: auto;
      }

      .hud::-webkit-scrollbar {
        width: 4px;
      }
      .hud::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
      }
      .hud::-webkit-scrollbar-thumb {
        background: #444;
        border-radius: 2px;
      }

      .hidden {
        display: none !important;
      }

      button {
        padding: 10px;
        background: #000;
        border: 1px solid #333;
        border-radius: 4px;
        color: #ccc;
        cursor: pointer;
        font-size: 12px;
        text-align: left;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.1s;
        flex-shrink: 0;
        outline: none;
      }

      button:hover {
        background: #252525;
        border-color: #444;
        color: #fff;
      }
      button:active {
        background: #333;
      }
      button:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }
      .themed-input {
        background: #111827;
        border: 1px solid #334155;
        color: #cbd5f5;
        border-radius: 6px;
      }
      .themed-input:focus {
        outline: 1px solid #475569;
      }
      select.themed-input {
        padding: 8px;
      }
      input[type='range'].themed-input {
        width: 100%;
        height: 8px;
        accent-color: #a855f7;
      }
      input[type='range'].themed-input::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: #a855f7;
        border: 1px solid #c084fc;
      }
      input[type='range'].themed-input::-moz-range-thumb {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: #a855f7;
        border: 1px solid #c084fc;
      }
      button.danger {
        border-color: #522;
        color: #e55;
      }
      button.danger:hover {
        background: #311;
      }

      button.action {
        background: #112;
        border-color: #335;
        color: #aaf;
        justify-content: center;
      }
      button.action:hover {
        background: #224;
      }

      button.active {
        background: #333;
        border-color: #666;
        color: #fff;
        box-shadow: inset 0 0 0 1px #555;
      }

      .separator {
        height: 1px;
        background: #333;
        margin: 4px 0;
        flex-shrink: 0;
      }

      .swatch {
        width: 10px;
        height: 10px;
        border-radius: 2px;
        display: inline-block;
      }

      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 30;
      }

      .modal-backdrop.hidden {
        display: none;
      }

      .modal {
        background: #0f0f0f;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 16px;
        width: min(880px, 95vw);
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
        position: relative;
      }

      .modal .close {
        position: absolute;
        top: 8px;
        right: 8px;
        border-radius: 50%;
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #333;
        background: #111;
        color: #fff;
        cursor: pointer;
      }

      .modal-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
      }

      .tab-button {
        flex: 1;
        justify-content: center;
      }

      .tab-button.active {
        background: #1f1f2a;
        border-color: #556;
        color: #fff;
      }

      .modal textarea {
        width: 100%;
        min-height: 220px;
        background: #0a0a0a;
        color: #e5e5e5;
        border: 1px solid #333;
        border-radius: 6px;
        padding: 12px;
        font-family: 'JetBrains Mono', monospace;
        resize: vertical;
      }

      .modal .divider {
        text-align: center;
        margin: 12px 0;
        color: #666;
        font-size: 12px;
      }

      .modal .actions {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
        margin-top: 10px;
      }

      .badge {
        background: #1f2937;
        color: #cbd5f5;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 10px;
        border: 1px solid #334155;
      }

      .context-menu {
        position: fixed;
        background: #0f0f0f;
        border: 1px solid #333;
        border-radius: 6px;
        padding: 6px;
        z-index: 40;
        min-width: 160px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      }

      .context-menu.hidden {
        display: none;
      }

      .context-menu button {
        width: 100%;
        justify-content: flex-start;
      }

      #logic-analyzer {
        position: fixed;
        left: var(--hud-offset);
        bottom: 0;
        width: calc(100% - var(--hud-offset));
        height: 140px;
        background: #0a0a0f;
        border-top: 1px solid #222;
        z-index: 5;
      }

      #minimap {
        position: fixed;
        bottom: 12px;
        right: 12px;
        width: 200px;
        height: 200px;
        background: #0b0b0b;
        border: 1px solid #222;
        border-radius: 6px;
        z-index: 6;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        cursor: crosshair;
      }

      .spotlight-backdrop {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.55);
        z-index: 50;
      }
      .spotlight {
        width: min(720px, 95vw);
        background: #0f0f0f;
        border: 1px solid #333;
        border-radius: 12px;
        padding: 14px;
        box-shadow: 0 18px 50px rgba(0, 0, 0, 0.6);
      }
      .spotlight.hidden,
      .spotlight-backdrop.hidden {
        display: none;
      }
      .spotlight input {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #334155;
        background: #0b1224;
        color: #e5e7eb;
        margin-bottom: 10px;
      }
      .spotlight-results {
        display: flex;
        flex-direction: column;
        gap: 6px;
        max-height: 320px;
        overflow-y: auto;
      }
      .spotlight-results button {
        width: 100%;
        justify-content: space-between;
      }

      .shortcut-modal .modal {
        width: min(520px, 92vw);
      }
      .shortcut-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
      }
      .shortcut-row input {
        flex: 1;
        padding: 8px;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>
    <div class="hud" id="hud"></div>
    <canvas id="logic-analyzer"></canvas>
    <canvas id="minimap" aria-label="Minimap overview"></canvas>

    <div class="modal-backdrop hidden" id="modal-backdrop">
      <div class="modal">
        <button class="close" id="modal-close" aria-label="Close modal">✕</button>
        <div class="modal-tabs">
          <button class="tab-button active" id="tab-save" data-tab="save">
            Save Project
          </button>
          <button class="tab-button" id="tab-load" data-tab="load">
            Load Project
          </button>
        </div>

        <div class="modal-content" data-tab="save">
          <textarea id="save-json" readonly></textarea>
          <div class="actions">
            <button id="copy-json">Copy JSON</button>
            <button id="download-json">Save as File</button>
          </div>
        </div>

        <div class="modal-content hidden" data-tab="load">
          <textarea
            id="load-json"
            placeholder="Paste JSON here..."
            aria-label="Load JSON"
          ></textarea>
          <div class="divider">--- OR ---</div>
          <input type="file" id="load-file" accept=".json" />
          <div class="actions">
            <button id="apply-load">Load Circuit</button>
          </div>
        </div>
      </div>
    </div>

    <div class="spotlight-backdrop hidden" id="spotlight-backdrop">
      <div class="spotlight">
        <input
          id="spotlight-input"
          type="text"
          placeholder="Search commands or components..."
          aria-label="Spotlight search"
        />
        <div class="spotlight-results" id="spotlight-results"></div>
      </div>
    </div>

    <div class="modal-backdrop hidden shortcut-modal" id="shortcut-backdrop">
      <div class="modal">
        <button class="close" id="shortcut-close" aria-label="Close shortcut mapper">
          ✕
        </button>
        <h3 style="margin-bottom: 8px; color: #e5e7eb">Shortcut Mapper</h3>
        <div id="shortcut-list"></div>
        <div class="actions">
          <button id="shortcut-export">Export</button>
          <button id="shortcut-import">Import</button>
          <button id="shortcut-reset">Reset Defaults</button>
        </div>
      </div>
    </div>

    <div class="context-menu hidden" id="ctx-menu"></div>

    <script src="./main.js"></script>
  </body>
</html>
